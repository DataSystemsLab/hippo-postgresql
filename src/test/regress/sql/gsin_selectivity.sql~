
set enable_seqscan = off;





BEGIN;

	CREATE TABLE LINEITEM (
		L_ORDERKEY		int8 NOT NULL, -- references O_ORDERKEY
		L_PARTKEY		int8 NOT NULL, -- references P_PARTKEY (compound fk to PARTSUPP)
		L_SUPPKEY		int8 NOT NULL, -- references S_SUPPKEY (compound fk to PARTSUPP)
		L_LINENUMBER	INTEGER,
		L_QUANTITY		DECIMAL,
		L_EXTENDEDPRICE	DECIMAL,
		L_DISCOUNT		DECIMAL,
		L_TAX			DECIMAL,
		L_RETURNFLAG	CHAR(1),
		L_LINESTATUS	CHAR(1),
		L_SHIPDATE		DATE,
		L_COMMITDATE	DATE,
		L_RECEIPTDATE	DATE,
		L_SHIPINSTRUCT	CHAR(25),
		L_SHIPMODE		CHAR(10),
		L_COMMENT		VARCHAR(44)
	);

	COPY lineitem FROM '/mnt/mongodb/jy_postgres/tpch/tpch_2_17_0/dbgen/lineitem.csv' WITH (FORMAT csv, DELIMITER '|');

COMMIT;







-- indexes on the foreign keys

\timing on

Alter table LINEITEM alter column L_PARTKEY set statistics 10000;

Analyze;

------------------------Point query-----------------------------


CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);

\di+;

select count(*) from lineitem where L_PARTKEY=10000;


drop index btree_idx;


CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);

select count(*) from lineitem where L_PARTKEY=50000;

drop index btree_idx;


CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);

select count(*) from lineitem where L_PARTKEY=100000;

drop index btree_idx;


CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);

select count(*) from lineitem where L_PARTKEY=150000;

drop index btree_idx;



CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);

select count(*) from lineitem where L_PARTKEY=190000;

drop index btree_idx;






CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);

\di+;

select count(*) from lineitem where L_PARTKEY=10000;

drop index gsin_idx;



CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);

select count(*) from lineitem where L_PARTKEY=50000;

drop index gsin_idx;


CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);

select count(*) from lineitem where L_PARTKEY=100000;

drop index gsin_idx;


CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);

select count(*) from lineitem where L_PARTKEY=150000;

drop index gsin_idx;



CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);

select count(*) from lineitem where L_PARTKEY=190000;

drop index gsin_idx;







CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);

\di+;

select count(*) from lineitem where L_PARTKEY=10000;

drop index brin_idx;


CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);

select count(*) from lineitem where L_PARTKEY=50000;

drop index brin_idx;


CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);

select count(*) from lineitem where L_PARTKEY=100000;

drop index brin_idx;


CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);

select count(*) from lineitem where L_PARTKEY=150000;

drop index brin_idx;



CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);

select count(*) from lineitem where L_PARTKEY=190000;

drop index brin_idx;






------------------------0.001%-----------------------------


CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10010;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50010;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100010;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<150010;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<190010;

drop index btree_idx;






CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10010;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50010;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100010;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<150010;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<190010;

drop index gsin_idx;







CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10010;


select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50010;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100010;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<150010;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<190010;

drop index brin_idx;








------------------------------------------0.01%---------------------------------



CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10100;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50100;


select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100100;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<150100;


select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<190100;

drop index btree_idx;






CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10100;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50100;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100100;


select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<150100;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<190100;

drop index gsin_idx;







CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10100;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50100;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100100;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<150100;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<190100;

drop index brin_idx;





-------------------------------------------0.1%--------------------------------






CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<11000;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<51000;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<101000;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<151000;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<191000;

drop index btree_idx;






CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<11000;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<51000;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<101000;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<151000;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<191000;

drop index gsin_idx;







CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);




select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<11000;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<51000;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<101000;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<151000;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<191000;

drop index brin_idx;
-------------------------------------------1%--------------------------------






CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<20000;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<60000;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<110000;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<160000;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<200000;

drop index btree_idx;






CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<20000;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<60000;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<110000;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<160000;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<200000;

drop index gsin_idx;







CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=128);



select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<20000;



select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<60000;



select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<110000;



select count(*) from lineitem where L_PARTKEY>150000 and L_PARTKEY<160000;



select count(*) from lineitem where L_PARTKEY>190000 and L_PARTKEY<200000;
drop index brin_idx;


---------------------------------------------
drop table lineitem;


