
set enable_seqscan = off;





BEGIN;

	CREATE TABLE LINEITEM (
		L_ORDERKEY		int8 NOT NULL, -- references O_ORDERKEY
		L_PARTKEY		int8 NOT NULL, -- references P_PARTKEY (compound fk to PARTSUPP)
		L_SUPPKEY		int8 NOT NULL, -- references S_SUPPKEY (compound fk to PARTSUPP)
		L_LINENUMBER	INTEGER,
		L_QUANTITY		DECIMAL,
		L_EXTENDEDPRICE	DECIMAL,
		L_DISCOUNT		DECIMAL,
		L_TAX			DECIMAL,
		L_RETURNFLAG	CHAR(1),
		L_LINESTATUS	CHAR(1),
		L_SHIPDATE		DATE,
		L_COMMITDATE	DATE,
		L_RECEIPTDATE	DATE,
		L_SHIPINSTRUCT	CHAR(25),
		L_SHIPMODE		CHAR(10),
		L_COMMENT		VARCHAR(44)
	);

	COPY lineitem FROM '/mnt/mongodb/jy_postgres/tpch/tpch_2_17_0/dbgen/data/500/lineitem.csv' WITH (FORMAT csv, DELIMITER '|');

COMMIT;







-- indexes on the foreign keys

\timing on

















CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);
\di+;
-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index btree_idx;


-------------------------------------------------------Histogram 400---------------------------------

Alter table LINEITEM alter column L_PARTKEY set statistics 400;

Analyze LINEITEM;


CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);
\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index gsin_idx;



CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=40);
\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index gsin_idx;







CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=10);

\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;

drop index brin_idx;



-------------------------------------------------------Histogram 800---------------------------------


Alter table LINEITEM alter column L_PARTKEY set statistics 800;

Analyze LINEITEM;


CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);
\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index gsin_idx;


CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=20);

\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index brin_idx;

-------------------------------------------------------Histogram 1600---------------------------------


Alter table LINEITEM alter column L_PARTKEY set statistics 1600;

Analyze LINEITEM;


CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);
\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index gsin_idx;


CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=40);

\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;



drop index brin_idx;

-------------------------------------------------------Histogram 3200---------------------------------


Alter table LINEITEM alter column L_PARTKEY set statistics 3200;

Analyze LINEITEM;


CREATE INDEX gsin_idx ON LINEITEM using gsin(L_PARTKEY) with (max_pages_per_range=20);
\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;
-------------------------------------------1%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<5000000;



explain analyze select count(*) from lineitem where L_PARTKEY>5000000 and L_PARTKEY<9000000;



explain analyze select count(*) from lineitem where L_PARTKEY>10000000 and L_PARTKEY<14000000;


drop index gsin_idx;


CREATE INDEX brin_idx ON LINEITEM using brin(L_PARTKEY) with (pages_per_range=79);

\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.01%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;




drop index brin_idx;
---------------------------------------------

CREATE INDEX btree_idx ON LINEITEM using btree(L_PARTKEY);
\di+;

-------------------------------------------0.001%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<10400;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<50400;


explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<100400;

-------------------------------------------0.01%--------------------------------

explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<14000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<54000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<104000;



-------------------------------------------0.1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>10000 and L_PARTKEY<50000;



explain analyze select count(*) from lineitem where L_PARTKEY>50000 and L_PARTKEY<90000;



explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<140000;

-------------------------------------------1%--------------------------------
explain analyze select count(*) from lineitem where L_PARTKEY>100000 and L_PARTKEY<500000;



explain analyze select count(*) from lineitem where L_PARTKEY>500000 and L_PARTKEY<900000;



explain analyze select count(*) from lineitem where L_PARTKEY>1000000 and L_PARTKEY<1400000;



drop index btree_idx;








---------------------------------------------
drop table lineitem;


